@page "/produktydelsecatalog"
@using ScooterLandProjectOpg.Shared.Models
@inject HttpClient Http

<div class="card shadow mb-4">
</div>
	<div class="card-header bg-primary text-white">
		<h3 class="card-title text-center mb-0">Produkt og Ydelse Katalog</h3>
	</div>
<style>
	.nav-tabs .nav-link {
		color: #495057; /* Neutral mørk farve for inaktive tabs */
		background-color: #f8f9fa; /* Lys baggrund */
		border: 1px solid #dee2e6; /* Standard grå kant */
		font-weight: bold; /* Fremhæv teksten */
		border-radius: 0.5rem; /* Afrundede hjørner */
		padding: 10px 20px; /* God størrelse for klikbarhed */
		transition: all 0.3s ease; /* Glidende effekt */
		text-align: center;
		box-shadow: none; /* Fjern skygge for inaktive tabs */
	}

		.nav-tabs .nav-link:hover {
			background-color: #007bff; /* Blå hover-baggrund */
			color: #fff; /* Hvid tekst ved hover */
			border-color: #0056b3; /* Mørkere blå kant */
			transform: scale(1.05); /* Let forstørrelse ved hover */
			box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.2); /* Skygge */
		}

		.nav-tabs .nav-link.active {
			color: #fff; /* Hvid tekst for aktiv tab */
			background-color: #007bff; /* Blå baggrund for aktiv tab */
			border-color: #0056b3; /* Mørkere blå kant */
			font-size: 18px; /* Gør aktiv tab lidt større */
			box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.3); /* Mere fremhævet skygge */
		}

		.nav-tabs .nav-link:not(.active) {
			background-color: #e2e6ea; /* Lys grå baggrund for inaktive tabs */
			color: #343a40; /* Mørk tekstfarve */
			border-color: #ced4da; /* Lys kant for inaktive tabs */
			opacity: 1; /* Fuld synlighed */
			font-size: 16px; /* Ensartet tekststørrelse */
			box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.1); /* Svag skygge */
		}

	.nav-tabs {
		justify-content: center; /* Centrer tabs */
		margin-bottom: 20px; /* Mellemrum under tabs */
	}
</style>

<!-- Tabs navigation -->
<ul class="nav nav-tabs d-flex">
	<li class="nav-item">
		<a class="nav-link @(aktivTab == "ydelser" ? "active" : "")" @onclick="@(() => AktivTabSkift("ydelser"))">
			Ydelser
		</a>
	</li>
	<li class="nav-item">
		<a class="nav-link @(aktivTab == "produkter" ? "active" : "")" @onclick="@(() => AktivTabSkift("produkter"))">
			Produkter
		</a>
	</li>
</ul>


	


<div class="tab-content mt-4">
	@if (aktivTab == "ydelser")
	{
		<div>
			<div class="d-flex justify-content-center mb-4">
				<button class="btn custom-btn" @onclick="VisOpretYdelseModal">Opret Ydelse</button>
			</div>
			@if (ydelser == null)
			{
				<div class="text-center">
					<p>Loading ydelser...</p>
				</div>
			}
			else
			{
				<table class="table table-hover table-striped shadow-sm">
					<thead class="table-light">
						<tr>
							<th>ID</th>
							<th>Navn</th>
							<th>Standard Pris</th>
							<th>Handlinger</th>
						</tr>
					</thead>
					<tbody>
						@foreach (var ydelse in ydelser)
						{
							<tr>
								<td>@ydelse.YdelseId</td>
								<td>@ydelse.Navn</td>
								<td>@ydelse.StandardPris?.ToString("F2") kr.</td>
								<td>
									<button class="btn btn-primary rounded-pill px-3" @onclick="() => VisRedigerYdelseModal(ydelse)">Rediger</button>
									<button class="btn btn-danger rounded-pill px-3" @onclick="() => BekræftSletYdelse(ydelse)">Slet</button>
								</td>
							</tr>
						}
					</tbody>
				</table>
			}
		</div>
	}
	else if (aktivTab == "produkter")
	{
		<div>
			<div class="d-flex justify-content-center mb-4">
				<button class="btn custom-btn" @onclick="VisOpretProduktModal">Opret Produkt</button>
			</div>
			@if (produkter == null)
			{
				<div class="text-center">
					<p>Loading produkter...</p>
				</div>
			}
			else
			{
				<table class="table table-hover table-striped shadow-sm">
					<thead class="table-light">
						<tr>
							<th>ID</th>
							<th>Navn</th>
							<th>Pris</th>
							<th>Lager Antal</th>
							<th>Handlinger</th>
						</tr>
					</thead>
					<tbody>
						@foreach (var produkt in produkter)
						{
							<tr>
								<td>@produkt.ProduktId</td>
								<td>@produkt.ProduktNavn</td>
								<td>@produkt.Pris?.ToString("F2") kr.</td>
								<td>@produkt.Antal</td>
								<td>
									<button class="btn btn-primary rounded-pill px-3" @onclick="() => VisRedigerProduktModal(produkt)">Rediger</button>
									<button class="btn btn-danger rounded-pill px-3" @onclick="() => BekræftSletProdukt(produkt)">Slet</button>
								</td>
							</tr>
						}
					</tbody>
				</table>
			}
		</div>
	}
</div>

<style>
	.custom-btn {
		background: linear-gradient(to bottom, #4f81bd, #1f4e79); /* Samme gradient som boksen */
		color: white; /* Tekstfarve */
		border: none; /* Fjern kant */
		border-radius: 25px; /* Afrundede hjørner */
		padding: 10px 20px; /* Størrelse på knappen */
		font-size: 16px; /* Tekststørrelse */
		box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.2); /* Skygge */
		transition: all 0.3s ease-in-out; /* Glidende hover-effekt */
	}

		.custom-btn:hover {
			background: linear-gradient(to bottom, #1f4e79, #4f81bd); /* Omvendt gradient på hover */
			transform: scale(1.1); /* Gør knappen lidt større */
			box-shadow: 0px 6px 8px rgba(0, 0, 0, 0.3); /* Mere markant skygge */
		}
</style>

@if (visYdelseModal)
{
	<EditForm Model="valgtYdelse" OnValidSubmit="GemYdelse">
		<div class="modal fade show d-block" tabindex="-1" style="background-color: rgba(0, 0, 0, 0.5);">
			<div class="modal-dialog modal-dialog-centered">
				<div class="modal-content shadow">
					<div class="modal-header bg-primary text-white">
						<h5 class="modal-title">@ydelseModalTitel</h5>
						<button type="button" class="btn-close btn-close-white" @onclick="LukYdelseModal"></button>
					</div>
					<div class="modal-body">
						<DataAnnotationsValidator />
						<div class="mb-3">
							<label for="navn" class="form-label">Navn</label>
							<InputText id="navn" @bind-Value="valgtYdelse.Navn" class="form-control" placeholder="Indtast ydelsesnavn" />
							<ValidationMessage For="@(() => valgtYdelse.Navn)" />
						</div>
						<div class="mb-3">
							<label for="pris" class="form-label">Standard Pris</label>
							<InputNumber id="pris" @bind-Value="valgtYdelse.StandardPris" class="form-control" placeholder="Indtast standard pris" />
							<ValidationMessage For="@(() => valgtYdelse.StandardPris)" />
						</div>
					</div>
					<div class="modal-footer d-flex justify-content-end">
						<button type="button" class="btn btn-secondary rounded-pill px-4 me-2" @onclick="LukYdelseModal">Annuller</button>
						<button type="submit" class="btn btn-success rounded-pill px-4">Gem</button>
					</div>
				</div>
			</div>
		</div>
	</EditForm>
}

@if (visProduktModal)
{
	<EditForm Model="valgtProdukt" OnValidSubmit="GemProdukt">
		<div class="modal fade show d-block" tabindex="-1" style="background-color: rgba(0, 0, 0, 0.5);">
			<div class="modal-dialog modal-dialog-centered">
				<div class="modal-content shadow">
					<div class="modal-header bg-primary text-white">
						<h5 class="modal-title">@produktModalTitel</h5>
						<button type="button" class="btn-close btn-close-white" @onclick="LukProduktModal"></button>
					</div>
					<div class="modal-body">
						<DataAnnotationsValidator />
						<div class="mb-3">
							<label for="navn" class="form-label">Navn</label>
							<InputText id="navn" @bind-Value="valgtProdukt.ProduktNavn" class="form-control" placeholder="Indtast produktnavn" />
							<ValidationMessage For="@(() => valgtProdukt.ProduktNavn)" />
						</div>
						<div class="mb-3">
							<label for="pris" class="form-label">Pris</label>
							<InputNumber id="pris" @bind-Value="valgtProdukt.Pris" class="form-control" placeholder="Indtast pris" />
							<ValidationMessage For="@(() => valgtProdukt.Pris)" />
						</div>
						<div class="mb-3">
							<label for="antal" class="form-label">Antal</label>
							<InputNumber id="antal" @bind-Value="valgtProdukt.Antal" class="form-control" placeholder="Indtast antal" />
							<ValidationMessage For="@(() => valgtProdukt.Antal)" />
						</div>
					</div>
					<div class="modal-footer d-flex justify-content-end">
						<button type="button" class="btn btn-secondary rounded-pill px-4 me-2" @onclick="LukProduktModal">Annuller</button>
						<button type="submit" class="btn btn-success rounded-pill px-4">Gem</button>
					</div>
				</div>
			</div>
		</div>
	</EditForm>
}


@if (visBekræftSletModal)
{
	<div class="modal fade show d-block" tabindex="-1" style="background-color: rgba(0, 0, 0, 0.5);">
		<div class="modal-dialog modal-dialog-centered">
			<div class="modal-content shadow">
				<div class="modal-header bg-danger text-white">
					<h5 class="modal-title">Bekræft Sletning</h5>
					<button type="button" class="btn-close btn-close-white" @onclick="LukBekræftSletModal"></button>
				</div>
				<div class="modal-body text-center">
					<p class="fs-5">Er du sikker på, at du vil slette <strong>@bekræftModalTitel</strong>?</p>
				</div>
				<div class="modal-footer d-flex justify-content-center">
					<button class="btn btn-secondary rounded-pill px-4 me-2" @onclick="LukBekræftSletModal">Annuller</button>
					<button class="btn btn-danger rounded-pill px-4" @onclick="BekræftSlet">Ja, Slet</button>
				</div>
			</div>
		</div>
	</div>
}

<div class="d-flex justify-content-center align-items-center position-relative mt-4" style="height: 150px;">
	<div class="alert alert-light border rounded-3 shadow-sm text-center"
		 style="max-width: 600px; width: 90%; padding: 15px; margin-bottom: 0;">
		<h6 class="text-primary fw-bold mb-2">Scooterland</h6>
		<p class="mb-1"><strong>Adresse:</strong> Hovedgade 123, 4000 Roskilde</p>
		<p class="mb-1"><strong>Telefon:</strong> 12 34 56 78</p>
		<p class="mb-1"><strong>Email:</strong> kontakt@scooterland.dk</p>
		<p class="mb-0"><strong>Dags dato:</strong> @DateTime.Now.ToString("dd-MM-yyyy")</p>
	</div>
</div>

@code {
	private string aktivTab = "ydelser";
	private List<Ydelse>? ydelser;
	private List<Produkt>? produkter;
	private Ydelse valgtYdelse = new();
	private Produkt valgtProdukt = new();
	private bool visYdelseModal = false;
	private bool visProduktModal = false;
	private string ydelseModalTitel = "";
	private string produktModalTitel = "";
	private bool visBekræftSletModal = false;
	private string bekræftModalTitel = "";
	private int? idTilSletning = null;
	private string aktivTypeTilSletning = ""; // "ydelse" eller "produkt"

	protected override async Task OnInitializedAsync()
	{
		await HentYdelser();
		await HentProdukter();
	}

	private async Task HentYdelser() => ydelser = await Http.GetFromJsonAsync<List<Ydelse>>("api/Ydelse");
	private async Task HentProdukter() => produkter = await Http.GetFromJsonAsync<List<Produkt>>("api/Produkt");

	private void AktivTabSkift(string tab) => aktivTab = tab;

	private void VisOpretYdelseModal()
	{
		valgtYdelse = new();
		ydelseModalTitel = "Opret Ydelse";
		visYdelseModal = true;
	}

	private void VisRedigerYdelseModal(Ydelse ydelse)
	{
		valgtYdelse = ydelse;
		ydelseModalTitel = "Rediger Ydelse";
		visYdelseModal = true;
	}

	private void LukYdelseModal() => visYdelseModal = false;

	private async Task GemYdelse()
	{
		if (valgtYdelse.YdelseId == 0)
		{
			await Http.PostAsJsonAsync("api/Ydelse", valgtYdelse);
		}
		else
		{
			await Http.PutAsJsonAsync($"api/Ydelse/{valgtYdelse.YdelseId}", valgtYdelse);
		}
		await HentYdelser();
		LukYdelseModal();
	}

	private void BekræftSletYdelse(Ydelse ydelse)
	{
		bekræftModalTitel = ydelse.Navn ?? "ukendt ydelse";
		idTilSletning = ydelse.YdelseId;
		aktivTypeTilSletning = "ydelse";
		visBekræftSletModal = true;
	}

	private void VisOpretProduktModal()
	{
		valgtProdukt = new();
		produktModalTitel = "Opret Produkt";
		visProduktModal = true;
	}

	private void VisRedigerProduktModal(Produkt produkt)
	{
		valgtProdukt = produkt;
		produktModalTitel = "Rediger Produkt";
		visProduktModal = true;
	}

	private void LukProduktModal() => visProduktModal = false;

	private async Task GemProdukt()
	{
		if (valgtProdukt.ProduktId == 0)
		{
			await Http.PostAsJsonAsync("api/Produkt", valgtProdukt);
		}
		else
		{
			await Http.PutAsJsonAsync($"api/Produkt/{valgtProdukt.ProduktId}", valgtProdukt);
		}
		await HentProdukter();
		LukProduktModal();
	}

	private void BekræftSletProdukt(Produkt produkt)
	{
		bekræftModalTitel = produkt.ProduktNavn ?? "ukendt produkt";
		idTilSletning = produkt.ProduktId;
		aktivTypeTilSletning = "produkt";
		visBekræftSletModal = true;
	}

	private void LukBekræftSletModal()
	{
		visBekræftSletModal = false;
		idTilSletning = null;
		aktivTypeTilSletning = "";
	}

	private async Task BekræftSlet()
	{
		if (idTilSletning != null)
		{
			if (aktivTypeTilSletning == "ydelse")
			{
				await Http.DeleteAsync($"api/Ydelse/{idTilSletning}");
				await HentYdelser();
			}
			else if (aktivTypeTilSletning == "produkt")
			{
				await Http.DeleteAsync($"api/Produkt/{idTilSletning}");
				await HentProdukter();
			}
		}
		LukBekræftSletModal();
	}
}
